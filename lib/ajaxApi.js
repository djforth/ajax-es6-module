(function(a,b){if('function'==typeof define&&define.amd)define(['exports','lodash/isFunction','lodash/forEach','lodash/isString','lodash/isUndefined','lodash/isArray','lodash/union'],b);else if('undefined'!=typeof exports)b(exports,require('lodash/isFunction'),require('lodash/forEach'),require('lodash/isString'),require('lodash/isUndefined'),require('lodash/isArray'),require('lodash/union'));else{var c={exports:{}};b(c.exports,a.isFunction,a.forEach,a.isString,a.isUndefined,a.isArray,a.union),a.ajaxApi=c.exports}})(this,function(a,b,c,d,e,f,g){'use strict';function j(t){return t&&t.__esModule?t:{default:t}}function k(t,u){if(!(t instanceof u))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(a,'__esModule',{value:!0});var l=j(b),m=j(c),n=j(d),o=j(e),p=j(f),q=j(g),r=function(){function t(u,v){for(var x,w=0;w<v.length;w++)x=v[w],x.enumerable=x.enumerable||!1,x.configurable=!0,'value'in x&&(x.writable=!0),Object.defineProperty(u,x.key,x)}return function(u,v,w){return v&&t(u.prototype,v),w&&t(u,w),u}}(),s=function(){function t(u){k(this,t),this.uri=u||null,this.state='GET',this.data=[],this.headers=[]}return r(t,[{key:'addRailsJSHeader',value:function(){this.addHeaders([{header:'Content-type',value:'application/json'},{header:'accept',value:'*/*;q=0.5, text/javascript, application/javascript, application/ecmascript, application/x-ecmascript'}])}},{key:'addHeaders',value:function(v){(0,p.default)(v)?this.headers=(0,q.default)(v,this.headers):this.headers.push(v)}},{key:'addID',value:function(v){return(0,o.default)(v)?this.uri:this.uri.match(/.json/)?this.uri.replace('.json','/'+v+'.json'):this.uri+'/'+v}},{key:'addUrl',value:function(v){if(!(0,n.default)(v))throw new Error('URL must be a string');this.uri=v}}]),r(t,[{key:'create',value:function(v,w){return this.state='POST',new Promise(function(x,y){this.getRequest(x,y,w,v)}.bind(this))}},{key:'destroy',value:function(v,w){this.state='POST';var x=this.getCSRF();this.addRailsJSHeader(),this.addHeaders({header:'X-Http-Method-Override',value:'delete'});var y={_method:'delete'};return y[x.param]=x.token,new Promise(function(z,A){this.getRequest(z,A,w,y,v)}.bind(this))}},{key:'fetch',value:function(v){return this.state='GET',new Promise(function(w,x){this.getRequest(w,x,v)}.bind(this))}},{key:'getCSRF',value:function(){var v=document.querySelector('meta[name=csrf-token]'),w=document.querySelector('meta[name=csrf-param]');return v&&this.headers.push({header:'X-CSRF-Token',value:v.content}),{token:v.content,param:w.content}}},{key:'getData',value:function(){return this.data}},{key:'getID',value:function(v,w){return w?w:v.id}},{key:'getRequest',value:function(v,w,x,y,z){if(this.url)throw new Error('URL not set');var A=this.setRequest(v,w,x),B=y?JSON.stringify(y):null;A.open(this.state,this.addID(z),!0),this.setHeaders(A),A.send(B)}},{key:'parseData',value:function(v){return(0,o.default)(v)||(this.data=JSON.parse(v)),this.data}},{key:'update',value:function(v,w,x){return this.state='PUT',new Promise(function(y,z){this.getRequest(y,z,x,v,this.getID(v,w))}.bind(this))}},{key:'readyState',value:function(v,w,x){200!==v.status&&0!==v.status&&x(new Error(v.statusText)),4===v.readyState&&(this.parseData(v.responseText),w(this.getData()))}},{key:'setHeaders',value:function(v,w){w&&this.addHeaders(w),(0,m.default)(this.headers,function(x){v.setRequestHeader(x.header,x.value)})}},{key:'setProgress',value:function(v,w){v.lengthComputable?w({percent:100*(v.loaded/v.total),loaded:v.loaded,total:v.total}):w({percent:100,loaded:v.loaded,total:v.loaded})}},{key:'setRequest',value:function(v,w,x){var y=new XMLHttpRequest;return(0,l.default)(x)&&(y.onprogress=function(){(0,l.default)(x)&&this.setProgress(y,x)}.bind(this)),y.onreadystatechange=function(){this.readyState(y,v,w)}.bind(this),y.onerror=function(){w(Error('Network Error'))},y}}]),t}();a.default=s});