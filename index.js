(function(a,b){if('function'==typeof define&&define.amd)define(['module','exports','lodash/isFunction','lodash/forEach','lodash/isString','lodash/isUndefined','lodash/isArray','lodash/union'],b);else if('undefined'!=typeof exports)b(module,exports,require('lodash/isFunction'),require('lodash/forEach'),require('lodash/isString'),require('lodash/isUndefined'),require('lodash/isArray'),require('lodash/union'));else{var c={exports:{}};b(c,c.exports,a.isFunction,a.forEach,a.isString,a.isUndefined,a.isArray,a.union),a.index=c.exports}})(this,function(a,b,c,d,e,f,g,j){'use strict';function k(u){return u&&u.__esModule?u:{default:u}}function l(u,v){if(!(u instanceof v))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(b,'__esModule',{value:!0});var m=k(c),n=k(d),o=k(e),p=k(f),q=k(g),r=k(j),s=function(){function u(v,w){for(var y,x=0;x<w.length;x++)y=w[x],y.enumerable=y.enumerable||!1,y.configurable=!0,'value'in y&&(y.writable=!0),Object.defineProperty(v,y.key,y)}return function(v,w,x){return w&&u(v.prototype,w),x&&u(v,x),v}}(),t=function(){function u(v){l(this,u),this.uri=v||null,this.state='GET',this.data=[],this.headers=[]}return s(u,[{key:'addRailsJSHeader',value:function(){this.addHeaders([{header:'Content-type',value:'application/json'},{header:'accept',value:'*/*;q=0.5, text/javascript, application/javascript, application/ecmascript, application/x-ecmascript'}])}},{key:'addHeaders',value:function(w){(0,q.default)(w)?this.headers=(0,r.default)(w,this.headers):this.headers.push(w)}},{key:'addID',value:function(w){return(0,p.default)(w)?this.uri:this.uri.match(/.json/)?this.uri.replace('.json','/'+w+'.json'):this.uri+'/'+w}},{key:'addUrl',value:function(w){if(!(0,o.default)(w))throw new Error('URL must be a string');this.uri=w}}]),s(u,[{key:'create',value:function(w,x){return this.state='POST',new Promise(function(y,z){this.getRequest(y,z,x,w)}.bind(this))}},{key:'destroy',value:function(w,x){this.state='POST';var y=this.getCSRF();this.addRailsJSHeader(),this.addHeaders({header:'X-Http-Method-Override',value:'delete'});var z={_method:'delete'};return z[y.param]=y.token,new Promise(function(A,B){this.getRequest(A,B,x,z,w)}.bind(this))}},{key:'fetch',value:function(w){return this.state='GET',new Promise(function(x,y){this.getRequest(x,y,w)}.bind(this))}},{key:'getCSRF',value:function(){var w=document.querySelector('meta[name=csrf-token]'),x=document.querySelector('meta[name=csrf-param]');return w&&this.headers.push({header:'X-CSRF-Token',value:w.content}),{token:w.content,param:x.content}}},{key:'getData',value:function(){return this.data}},{key:'getID',value:function(w,x){return x?x:w.id}},{key:'getRequest',value:function(w,x,y,z,A){if(this.url)throw new Error('URL not set');var B=this.setRequest(w,x,y),C=z?JSON.stringify(z):null;B.open(this.state,this.addID(A),!0),this.setHeaders(B),B.send(C)}},{key:'parseData',value:function(w){return(0,p.default)(w)||(this.data=JSON.parse(w)),this.data}},{key:'update',value:function(w,x,y){return this.state='PUT',new Promise(function(z,A){this.getRequest(z,A,y,w,this.getID(w,x))}.bind(this))}},{key:'readyState',value:function(w,x,y){200!==w.status&&0!==w.status&&y(new Error(w.statusText)),4===w.readyState&&(this.parseData(w.responseText),x(this.getData()))}},{key:'setHeaders',value:function(w,x){x&&this.addHeaders(x),(0,n.default)(this.headers,function(y){w.setRequestHeader(y.header,y.value)})}},{key:'setProgress',value:function(w,x){w.lengthComputable?x({percent:100*(w.loaded/w.total),loaded:w.loaded,total:w.total}):x({percent:100,loaded:w.loaded,total:w.loaded})}},{key:'setRequest',value:function(w,x,y){var z=new XMLHttpRequest;return(0,m.default)(y)&&(z.onprogress=function(){(0,m.default)(y)&&this.setProgress(z,y)}.bind(this)),z.onreadystatechange=function(){this.readyState(z,w,x)}.bind(this),z.onerror=function(){x(Error('Network Error'))},z}}]),u}();b.default=t,a.exports=b['default']});
